---
layout: post
title:  "SSRF ì˜ˆë°©ë²• (Server Side Request Forgery Prevention)"
subtitle: "ì•Œë©´ ì‰½ì§€ë§Œ ëª¨ë¥´ë©´ ì–´ë ¤ìš´ ë³´ì•ˆ"
author: "ì½”ë§ˆ (gbkim1988@gmail.com)"
date:   2019-09-09 00:00:00 +0900
categories: [ "ssrf", "security", "mitigation", "15m"]
excerpt_separator: <!--more-->
---

ì•ˆë…•í•˜ì„¸ìš” **ì½”ë§ˆ**ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ SSRF ë¼ëŠ” ê³µê²© ê¸°ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê³  íš¨ê³¼ì ì¸ ë³´ì•ˆ ë°©ë²•ì„ ëª¨ìƒ‰í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤. 

<!--more-->

## SSRF ë€?

í˜¹ì‹œ CSRF ë¼ëŠ” ê³µê²©ì— ëŒ€í•´ì„œ ë“¤ì–´ë³´ì‹ ì ì´ ìˆë‚˜ìš”? ì•„ë§ˆë„ ë§ì€ ë¶„ë“¤ì´ XSSì™€ í•¨ê»˜ ê°€ì¥ ë§ì´ ë°œìƒí•˜ëŠ” ê³µê²©ìœ¼ë¡œ ì•Œê³  ìˆì„ ê²ƒ ê°™ë„¤ìš”.

SSRF ëŠ” CSRF ì™€ ìœ ì‚¬í•œ ê³µê²© ë°©ì‹ì…ë‹ˆë‹¤. CSRFëŠ” í´ë¼ì´ì–¸íŠ¸ë¡œ í•˜ì—¬ê¸ˆ ê³µê²©ìê°€ ê°•ì œí•œ ì œì–´ ë™ì‘ì„ ìˆ˜í–‰í•˜ë„ë¡ í•˜ëŠ” ê³µê²© ë°©ì‹ì…ë‹ˆë‹¤. ëŒ€ì‹ , SSRF ëŠ” ì„œë²„ë¡œ í•˜ì—¬ê¸ˆ ê³µê²©ìê°€ ê°•ì œí•œ ì œì–´ ë™ì ì„ ìˆ˜í–‰í•˜ë„ë¡ í•˜ëŠ” ê³µê²© ë°©ì‹ì…ë‹ˆë‹¤. 

ê³µê²©ì˜ ëŒ€ìƒì´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ ë°”ë€ ê²ƒì…ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ ì–´ë–»ê²Œ ì´ëŸ¬í•œ ê³µê²©ì´ ê°€ëŠ¥í•˜ê²Œ ë˜ì—ˆì„ê¹Œìš”?

ì´ëŠ”, ì‹ ë¢° ì£¼ì²´ì— ëŒ€í•œ ë§¹ëª©ì ì¸ ë¯¿ìŒìœ¼ë¡œ ì¸í•´ ì‹ ë¢° ì£¼ì²´ê°€ ì œê³µí•œ ë°ì´í„°ë¥¼ ì™„ë²½íˆ ì‹ ë¢°í•  ê²½ìš° ë°œìƒí•˜ëŠ” ì·¨ì•½ì ì…ë‹ˆë‹¤. ì•„ë˜ì˜ ì¡°ê±´ì„ ì‚´í´ë³¼ê¹Œìš”?

1. í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­(claim)ì„ ìš”ì²­í•˜ëŠ” ì„œë²„ê°€ 2ê°œê°€ ì¡´ì¬í•©ë‹ˆë‹¤.
2. ì„œë²„ AëŠ” ì„œë²„ Bì˜ ì •ë³´ë¥¼ ìˆ˜ì‹ í•œ ë’¤ì— ì´ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— ë°˜ì˜í•©ë‹ˆë‹¤.
  - MSA êµ¬ì¡°ì—ì„œ í”íˆ ë°œìƒí•˜ëŠ” ì·¨ì•½ì ìœ¼ë¡œ ì—¬ê²¨ì§‘ë‹ˆë‹¤.
  - MSA ì•„í‚¤í…ì²˜ì—ì„œëŠ” ì„œë²„ê°„ì˜ ëŒ€í™”ë¥¼ í†µí•´ ì„œë¡œ ë‹¤ë¥¸ ì •ë³´ë¥¼ ì¡°ì¸í•˜ëŠ” ê³¼ì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
    - Graphql ê³¼ ê°™ì€ ê¸°ìˆ ì„ ë– ì˜¬ë ¤ ë³´ì‹¤ê¹Œìš”?
3. SSRF ì˜ ì·¨ì•½ì ì´ ë°œìƒí•  ê²½ìš° ì–´ë–¤ ì„œë²„ê°€ ì·¨ì•½í•˜ë‹¤ê³  íŒë‹¨ë ê¹Œìš”? 
  - ì„œë²„ Aì—ì„œ ìš”ì²­(Claim)ì„ ë¬´ë¶„ë³„í•˜ê²Œ ì‹ ë¢°í•˜ì˜€ìœ¼ë¯€ë¡œ ì·¨ì•½í•œ ì„œë²„(ì–´í”Œë¦¬ì¼€ì´ì…˜)ì´ë¼ê³  íŒë‹¨í•©ë‹ˆë‹¤.

[![SSRF ê³µê²© êµ¬ì„±ë„](https://raw.githubusercontent.com/OWASP/CheatSheetSeries/master/assets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet_SSRF_Common_Flow.png)](https://raw.githubusercontent.com/OWASP/CheatSheetSeries/master/assets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet_SSRF_Common_Flow.png)

### ê³µê²© ë°œìƒ ìƒí™©

ì—¬ëŸ¬ë¶„ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì•„ë˜ì˜ êµ¬í˜„ì„ í•˜ê³  ìˆë‹¤ë©´ SSRF ì˜ ê°€ëŠ¥ì„±ì„ ì—¼ë‘í•´ë‘ê³  ì½”ë“œë¥¼ ì§„ë‹¨í•´ ë³´ì•„ì•¼ í•©ë‹ˆë‹¤. SSRF ì˜ ê³µê²© ë²¡í„°ëŠ” ìœ„ì—ì„œ ì¥í™©í•˜ê²Œ ì„¤ëª…í•˜ì˜€ì§€ë§Œ ê²°êµ­ì€ ì•„ë˜ì™€ ê°™ì´ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ê³µê²© ë²¡í„°ì˜ ì¼ì¢…ìœ¼ë¡œ ë‚´ë¶€/ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ì™€ í†µì‹ í•˜ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì•…ìš©í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.**

ëŒ€í‘œì ìœ¼ë¡œ URL ì²˜ë¦¬ ê³¼ì •ì—ì„œ ì´ëŸ¬í•œ ê³µê²© ë²¡í„°ê°€ ë“œëŸ¬ë‚˜ëŠ”ë°ìš”. ì•„ë˜ì˜ ì˜ˆë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

1. ì™¸ë¶€ ì„œë²„ì˜ ì´ë¯¸ì§€ URL
  - ë§Œì•½ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì˜ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ì €ì¥í•œë‹¤ê³  ê°€ì •í•˜ê²Œ ë  ê²½ìš° ê³µê²© ë²¡í„°ê°€ ë³´ì…ë‹ˆë‹¤.
2. ì‚¬ìš©ì ì •ì˜ ì›¹í›…(Webhook)
  - ì›¹í›…ì€ Git, Jenkins ì—ì„œë„ ë§ì€ ì“°ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. íŠ¹ì • ì´ë²¤íŠ¸ê°€ ë°œìƒ ì‹œ ì§€ì •ëœ URLë¡œ ì½œë°± ë¦¬í€˜ìŠ¤íŠ¸ë¥¼ ì „ì†¡í•˜ì—¬ íŠ¹ì • ì´ë²¤íŠ¸ì˜ ë°œìƒì„ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì— ì•Œë¦¬ëŠ” ê²½ìš°ì…ë‹ˆë‹¤.
3. ë‚´ë¶€ê¹Œì§€ ì „íŒŒë˜ëŠ” ì‚¬ìš©ì ìš”ì²­
  - ì¦‰, ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë‚´ë¶€ ì„œë¹„ìŠ¤ê¹Œì§€ ìš”ì²­ì„ ì „íŒŒí•˜ëŠ” ê²½ìš°ì…ë‹ˆë‹¤.

### ê¸°ì–µí•´ì•¼í•  ì‚¬í•­
  - SSRF ëŠ” í”„ë¡œí† ì½œì— ì œí•œì„ ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¦‰, FTP, SMB, SMTP ë“±ì˜ ë‹¤ë¥¸ í”„ë¡œí† ì½œì´ë‚˜ `file://`, `phar://`, `gopher://` ë“±ì˜ URI ìŠ¤í‚´(URI Scheme)ë“±ì„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
  - ë§Œì•½ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ XXE ì¸ì ì…˜ ê³µê²©ì— ì·¨ì•½í•˜ë‹¤ë©´ SSRF ê³µê²©ì„ ê²€í† í•´ë³¼ë§Œ í•©ë‹ˆë‹¤. 
    - XXE ì¸ì ì…˜ ê³µê²©ì„ ì´ë¯¸ ì½”ë§ˆëŠ” ë‹¤ë£¨ì—ˆìŠµë‹ˆë‹¤. ì´ [XXE ì¸ì ì…˜ ë°©ì–´]({% link _posts/2019/07/2019-07-28-How-to-prevent-XXE Injection.markdown %}) ì°¸ì¡°í•´ì£¼ì„¸ìš”! 

## SSRF ë°œë™ ì¡°ê±´

ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ê¸°ëŠ¥ê³¼ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ SSRF ê³µê²©ì´ ë°œìƒí•˜ëŠ” ì¼€ì´ìŠ¤ë¥¼ ë‘ ê°€ì§€ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. **ì‚¬ë¡€ 1**: ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹ ë¢°í•˜ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ê²Œ ìš”ì²­ì„ ì „ì†¡í•  ìˆ˜ ìˆì„ ë•Œ
2. **ì‚¬ë¡€ 2**: ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì–´ë– í•œ ì™¸ë¶€ IP ë‚˜ ë„ë©”ì¸ìœ¼ë¡œ ìš”ì²­ì„ ì „ì†¡í•  ìˆ˜ ìˆì„ ë•Œ

## ì‚¬ë¡€ 1

ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ ìƒí™©ì— ë”°ë¼ ë‹¤ë¥¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ê²Œ ìš”ì²­ì„ ì „ë‹¬í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ìœ„ì¹˜ëŠ” ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­ì´ê±°ë‚˜ ì™¸ë¶€ ì„œë¹„ìŠ¤ì¸ ê²½ìš° ë“± ë‹¤ì–‘í•©ë‹ˆë‹¤. 

ì´ëŸ¬í•œ êµ¬ì„±ì€ ëª¨ë‘ íŠ¹ì •í•œ ëª©ì  í˜¹ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ì„œ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ì˜ˆë¥¼ë“¤ì–´ ì‡¼í•‘ëª° Aì™€ ì‡¼í•‘ëª° Bì˜ ìƒí’ˆ ì •ë³´ë¥¼ ê³µìœ í•˜ëŠ” ì œíœ´ë¥¼ ë§ºì—ˆë‹¤ê³  ê°€ì •í•´ë³´ë©´ ì´í•´ê°€ ì‰½ìŠµë‹ˆë‹¤.

### HR ì‚¬ë¡€

ì—¬ëŸ¬ë¶„ë“¤ì´ ì£¼ë¡œ ì‚¬ìš©í•˜ì˜€ì„ë§Œí•œ ê·¸ë£¹ì›¨ì–´ ì‹œìŠ¤í…œì„ ì•Œì•„ë³¼ê¹Œìš”? ì•„ë˜ì˜ ì¡°ê±´ì— ìœ ë…í•´ ì£¼ì„¸ìš”.

1. ì‹ ê·œ ê·¸ë£¹ì›¨ì–´ëŠ” HR ì‹œìŠ¤í…œì— ì ‘ê·¼í•˜ì—¬ ì„ì§ì›ì˜ í”„ë¡œí•„ ì •ë³´ë¥¼ ìš”ì²­í•œë‹¤.
2. ì„ì§ì›ì€ HR ì‹œìŠ¤í…œì— ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.
3. ê·¸ë£¹ì›¨ì–´ì™€ HR ì‹œìŠ¤í…œì€ í”„ë¡œí† ì½œì„ í†µí•´ì„œ í†µì‹ í•œë‹¤.

ë§Œì•½ì— ì—¬ëŸ¬ë¶„ì´ ë³´ì•ˆ ë‹´ë‹¹ìì˜ ì…ì¥ì´ê³  ê³µê²©ìê°€ ì‹ ê·œ ê·¸ë£¹ì›¨ì–´ë¥¼ ì•…ìš©í•  ê°€ëŠ¥ì„±ì„ ê²€í† í•˜ê³ ì í•©ë‹ˆë‹¤. ì¼ë°˜ì ì¸ ìƒí™©ì—ì„œ ì„ì§ì›ì€ HR ì‹œìŠ¤í…œì— ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê·¸ë£¹ì›¨ì–´ë¥¼ í†µí•´ì„œ íŒŒë¼ë¯¸í„°ë¥¼ ë³€ì¡°í•œë‹¤ë©´ HR ì‹œìŠ¤í…œì€ ê·¸ë£¹ì›¨ì–´ë¥¼ ì™„ì „íˆ ì‹ ë¢°í•˜ê³  ìš”ì²­í•œ ì •ë³´ë¥¼ ì œê³µí•  ìˆ˜ ë°–ì— ì—†ìŠµë‹ˆë‹¤.

### ë°©ì–´ ë°©ë²•

ì´ëŸ¬í•œ ë¥˜ì˜ ê³µê²©ì— ëŒ€í•´ ì‹œìŠ¤í…œì„ ì•ˆì „í•˜ê²Œ ë³´í˜¸í•˜ëŠ” ë°©ë²•ì€ ì–´í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µê³¼ ë„¤íŠ¸ì›Œí¬ ê³„ì¸µì— ëŒ€í•´ ê°ê° ë³´ì•ˆ ê°•í™”(Hardening)ë¥¼ í•©ë‹ˆë‹¤.

- ì–´í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ

ì²«ë²ˆì§¸ë¡œ ë– ì˜¤ë¥´ëŠ” ê²ƒì€ ì…ë ¥ê°’ ê²€ì¦(Input Validation)ì¼ ê²ƒì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ Orange TsaiëŠ” í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ì˜ ì…ë ¥ê°’ ê²€ì¦ë°©ë²•ì„ ì œì•ˆí•œë‹¤. 

ë‚´ë¶€ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì „ì†¡ë˜ëŠ” ìš”ì²­ì€ ì•„ë˜ì˜ ì •ë³´ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

- ë¬¸ìì—´ì´ í¬í•¨ëœ ë°ì´í„°
- IP ì£¼ì†Œ ì •ë³´
- ë„ë©”ì¸ ì´ë¦„
- URL ì •ë³´

### ë¬¸ìì—´

SSRF ê´€ì ì—ì„œ ê²€ì¦ ì½”ë“œê°€ ì ì ˆí•œ ìœ„ì¹˜ì—ì„œ ë™ì‘í•˜ì—¬ í•©ë‹ˆë‹¤. ì•„ë˜ì˜ ì •ê·œí‘œí˜„ì‹ì„ í†µí•œ ë¬¸ìì—´ ë°ì´í„° ê²€ì¦ ê³¼ì •ì„ ì‚´í´ë³¼ê¹Œìš”?

```java
// ë‹¨ìˆœí•œ í¬ë§·ì˜ ë°ì´í„°ì— ëŒ€í•œ ì •ê·œì‹ ê²€ì¦
if(Pattern.matches("[a-zA-Z0-9\\s\\-]{1,50}", userInput)){
    // ìœ íš¨í•  ê²½ìš° ì²˜ë¦¬ë¥¼ ì§€ì†
}else{
    // ê·¸ë ‡ì§€ ì•Šì„ ê²½ìš° ìš”ì²­ì„ ê±°ì ˆí•˜ê³  ì²˜ë¦¬ë¥¼ ì¤‘ì§€
}
```

### ì•„ì´í”¼ ì£¼ì†Œ

SSRF ê´€ì ì—ì„œ ì•„ì´í”¼ ì£¼ì†Œ ë°ì´í„°ì— ëŒ€í•´ ì•„ë˜ì˜ ê²€ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.

1. IP ì •ë³´ê°€ ìœ íš¨í•œ V4 ë˜ëŠ” V6 ì£¼ì†Œì¸ì§€ë¥¼ í™•ì¸
2. IP ì£¼ì†Œê°€ ì‹ ë¢°í•˜ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì£¼ì†Œ ì¸ì§€ í™•ì¸

ê·¸ë ‡ë‹¤ë©´, IP ê²€ì¦ì„ í¸ë¦¬í•˜ê²Œ í•´ì£¼ëŠ” ì–¸ì–´ë³„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª©ë¡ì„ í•œë³€ ì‚´í´ë³¼ê¹Œìš”? ì—¬ëŸ¬ë¶„ì—ê²Œ ì¢‹ì€ ì •ë³´ë¥¼ ì œê³µí•  ìˆ˜ ìˆì„ ë“¯í•˜ì—¬ í‘œë¡œ ì •ë¦¬í•´ ë³´ì•˜ìŠµë‹ˆë‹¤. (ğŸ‘ğŸ‘ğŸ‘)

|ì–¸ì–´|ë¼ì´ë¸ŒëŸ¬ë¦¬|ë¹„ê³ |
|:---:|:---:|:---:|
|Java|[Apache : Common Validator](http://commons.apache.org/proper/commons-validator/)|`InetAddressValidator.isValid` ë©”ì„œë“œë¥¼ ì´ìš©í•œ ê²€ì¦|
|.NET|.NET SDK ì´ìš©|[.NET SDK: IPAddress.TryParse](https://docs.microsoft.com/en-us/dotnet/api/system.net.ipaddress.tryparse?view=netframework-4.8) ì°¸ê³ |
|Javascript|[NPM : ip-address](https://www.npmjs.com/package/ip-address)|SDK ë¬¸ì„œë¥¼ ì°¸ì¡°|
|Python|[ipaddress ëª¨ë“ˆ](https://docs.python.org/3/library/ipaddress.html)| SDK ë¬¸ì„œë¥¼ ì°¸ì¡°|
|Ruby|[IPAddr ëª¨ë“ˆ](https://ruby-doc.org/stdlib-2.0.0/libdoc/ipaddr/rdoc/IPAddr.html)|SDK ë¬¸ì„œë¥¼ ì°¸ì¡°|

ìœ„ì—ì„œ ì–¸ê¸‰í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¶œë ¥ëœ ê²°ê³¼ ê°’ì„ IP ì£¼ì†Œë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ëª©ë¡ê³¼ ë¹„êµí•˜ì—¬ ìœ íš¨ì„± ê²€ì¦ì„ í•  ê²½ìš° ì•ˆì „ì„±ì´ ë†’ì•„ì§‘ë‹ˆë‹¤.

### ë„ë©”ì¸ ì´ë¦„

ë„ë©”ì¸ ì´ë¦„ì„ ê¸°ë°˜ìœ¼ë¡œ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” í˜¸ìŠ¤íŠ¸ë¥¼ íŒë³„í•˜ëŠ” ê³¼ì •ì€ ì•„ë˜ì˜ ìš°ë ¤ ì‚¬í•­ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

- DNS ì„œë²„ ì„¤ì •ì„ ì´ìš©í•œ ê³µê²©ì„ í†µí•´ DNS Resoultion ê³¼ì •ì— ê°œì…

1. ì´ëŠ” ì™¸ë¶€ DNS Resolver ë¡œ ì •ë³´ë¥¼ ë…¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
2. ë‚´ë¶€ IP ì£¼ì†Œë¡œ ìœ íš¨í•œ ë„ë©”ì¸ ì´ë¦„ì„ ë°”ì¸ë”©í•˜ëŠ” ê³µê²©ì— ì•…ìš©
  - Exploit > ìš°íšŒ > ì…ë ¥ê°’ ê²€ì¦ > DNS í”¼ë‹
3. ë‚´ë¶€ DNS Resolver ì— ì•…ì„± ë°ì´í„°(Payload)ë¥¼ ì „ë‹¬

SSRF ê´€ì ì—ì„œ ì•„ë˜ì˜ ìœ íš¨ì„± ê²€ì¦ì„ ìƒê°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. ìœ íš¨í•œ ë„ë©”ì¸ ì´ë¦„ì¸ì§€ë¥¼ ê²€ì¦
2. í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ì˜ ë„ë©”ì¸ ì´ë¦„ì— ì†í•˜ëŠ”ì§€ ì²´í¬

ê·¸ë ‡ë‹¤ë©´ ì´ëŸ¬í•œ ê²€ì¦ì„ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì—” ë¬´ì—‡ì´ ìˆì„ê¹Œìš”? ì•„ë˜ì˜ í…Œì´ë¸”ë¡œ ì •ë¦¬í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

|ì–¸ì–´|ë¼ì´ë¸ŒëŸ¬ë¦¬|ë¹„ê³ |
|:---:|:---:|:---:|
|Java|[Apache : Common Validator](http://commons.apache.org/proper/commons-validator/)|`DomainValidator.isValid` ë©”ì„œë“œë¥¼ ì´ìš©í•œ ê²€ì¦|
|.NET|.NET SDK ì´ìš©|[.NET SDK: Uri.CheckHostName](https://docs.microsoft.com/en-us/dotnet/api/system.uri.checkhostname?view=netframework-4.8) ì°¸ê³ |
|Javascript|[NPM : ip-valid-domain](https://www.npmjs.com/package/is-valid-domain)|SDK ë¬¸ì„œë¥¼ ì°¸ì¡°|
|Python|[validators.domain ëª¨ë“ˆ](https://validators.readthedocs.io/en/latest/#module-validators.domain)| SDK ë¬¸ì„œë¥¼ ì°¸ì¡°|
|Ruby|ì•„ì‰½ê²Œë„ ì—†ìŠµë‹ˆë‹¤.|í•˜ë‹¨ì„ ì°¸ì¡°|

- Ruby ì·¨ì•½ì  ë²¡í„°

domainator, public_suffix, addressable ë“±ì€ ì•„ë˜ì˜ ë„ë©”ì¸ ì´ë¦„ì„ ìœ íš¨í•œ ë„ë©”ì¸ ì´ë¦„ìœ¼ë¡œ ì¹˜ë¶€í•©ë‹ˆë‹¤.
ì¦‰, ê³µê²© ì„±ê³µ ê°€ëŠ¥ì„±ì´ ë†’ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

```html
<script>alert(1)</script>.owasp.org
```

Ruby ê°œë°œìë¶„ë“¤ì€ ì•„ë˜ì˜ ì½”ë“œë¥¼ ì°¸ì¡°í•˜ì…”ì„œ ì ì ˆíˆ ë„ë©”ì¸ ìœ íš¨ì„± ê²€ì¦ì„ ìˆ˜í–‰í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

`^(((?!-))(xn--|_{1,1})?[a-z0-9-]{0,61}[a-z0-9]{1,1}\.)*(xn--)?([a-z0-9][a-z0-9\-]{0,60}|[a-z0-9-]{1,30}\.[a-z]{2,})$` ([ì¶œì²˜: StackOverflow.com](https://stackoverflow.com/questions/10306690/what-is-a-regular-expression-which-will-match-a-valid-domain-name-without-a-subd/26987741#26987741))

ì‹¤ì œ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```ruby
domain_names = ["owasp.org","owasp-test.org","doc-test.owasp.org","doc.owasp.org", 
                "<script>alert(1)</script>","<script>alert(1)</script>.owasp.org"]
domain_names.each { |domain_name|
    if ( domain_name =~ /^(((?!-))(xn--|_{1,1})?[a-z0-9-]{0,61}[a-z0-9]{1,1}\.)*(xn--)?([a-z0-9][a-z0-9\-]{0,60}|[a-z0-9-]{1,30}\.[a-z]{2,})$/ )
        puts "[i] #{domain_name} is VALID"
    else
        puts "[!] #{domain_name} is INVALID"
    end
}
```

ìœ íš¨í•œ ë„ë©”ì¸ ì´ë¦„ì¸ì§€ë¥¼ ê²€ì¦í•˜ì˜€ìœ¼ë‹ˆ ì´ì œ ë‘ë²ˆì§¸ ë‹¨ê³„ì˜ ê²€ì¦ì„ í•©ë‹ˆë‹¤.

1. ì‹ ë¢° í•  ìˆ˜ ìˆëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ë„ë©”ì¸ ì´ë¦„ì„ í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬
2. ë„ë©”ì¸ ì´ë¦„ì´ í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ì— í¬í•¨ë˜ëŠ”ì§€ ì²´í¬

ê·¸ëŸ¬ë‚˜ DNS Pinning ì„ ì´ìš©í•œ ê³µê²©ì—ëŠ” ì—¬ì „íˆ ì·¨ì•½í•©ë‹ˆë‹¤. ì¦‰, ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œê°€ ì‹¤í–‰ë  ê²½ìš° DNS Resolutionì´ ë°œìƒí•˜ê¸° ë•Œë¬¸ì´ì£ . ì´ëŸ¬í•œ ë¬¸ì œë¥¼ ì‚¬ì „ì— ì°¨ë‹¨í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ì˜ ì¡°ì¹˜ë“¤ì„ í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

1. DNS Resolver ì²´ì„ì„ êµ¬ì„± í•  ë•Œ, ë‚´ë¶€ DNS ì„œë²„ë¥¼ ì²«ë²ˆì§¸ ìˆœì„œë¡œ ë‘¡ë‹ˆë‹¤.
2. ë„ë©”ì¸ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ë¥¼ ê°ì‹œí•˜ì—¬ ì´ë“¤ ì¤‘ ì•„ë˜ì— í•´ë‹¹í•˜ëŠ” ê²½ìš°ë¥¼ ê°ì§€í•©ë‹ˆë‹¤.
  - ë¡œì»¬ IP (v4 ë˜ëŠ” v6)
  - ë‚´ë¶€ë§ IP

```python
# Dependencies: pip install ipaddress dnspython
import ipaddress
import dns.resolver

# ë„ë©”ì¸ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ êµ¬ì„±
DOMAINS_WHITELIST = ["owasp.org", "labslinux"]

# DNS ì§ˆì˜ë¥¼ ì „ë‹¬í•  DNS Resolver ë¥¼ êµ¬ì„±
DNS_RESOLVER = dns.resolver.Resolver()
DNS_RESOLVER.nameservers = ["1.1.1.1"] # ê°€ìƒì˜ ì•„ì´í”¼ ì…ë‹ˆë‹¤.

def verify_dns_records(domain, records, type):
    """
    ê³µì¸ì´ ì•„ë‹Œ ì•„ì´í”¼ ì£¼ì†Œì— ëŒ€í•´ DNS ë ˆì½”ë“œ ì¡°íšŒë¥¼ í•˜ë©° 
    ì—ëŸ¬ ë°œìƒ ì—¬ë¶€ë¥¼ í†µí•´ Boolean ê°’ì„ ë¦¬í„´í•œë‹¤.
    """
    error_detected = False
    if records is not None:
        for record in records:
            value = record.to_text().strip()
            try:
                ip = ipaddress.ip_address(value)
                # See https://docs.python.org/3/library/ipaddress.html#ipaddress.IPv4Address.is_global
                if not ip.is_global:
                    print("[!] DNS record type '%s' for domain name '%s' resolve to 
                    a non public IP address '%s'!" % (type, domain, value))
                    error_detected = True
            except ValueError:
                error_detected = True
                print("[!] '%s' is not valid IP address!" % value)
    return error_detected
            
def check():
    """
    ë„ë©”ì¸ í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì²´í¬í•œë‹¤. ì—ëŸ¬ê°€ ë°œìƒí•  ê²½ìš° ë¶ˆë¦°ê°’ì„ ë¦¬í„´í•œë‹¤.
    ìˆœì„œ
    1. A ë ˆì½”ë“œë¥¼ ì¡°íšŒ 
    2. AAAA ë ˆì½”ë“œë¥¼ ì¡°íšŒ

    """
    error_detected = False
    for domain in DOMAINS_WHITELIST:    
        # Get the IPs of the curent domain
        # See https://en.wikipedia.org/wiki/List_of_DNS_record_types
        try:
            # A = IPv4 address record        
            ip_v4_records = DNS_RESOLVER.query(domain, "A")
        except Exception as e:
            ip_v4_records = None            
            print("[i] Cannot get A record for domain '%s': %s\n" % (domain,e))        
        try:
            # AAAA = IPv6 address record
            ip_v6_records = DNS_RESOLVER.query(domain, "AAAA")
        except Exception as e:
            ip_v6_records = None
            print("[i] Cannot get AAAA record for domain '%s': %s\n" % (domain,e))
        # Verify the IPs obtained
        if verify_dns_records(domain, ip_v4_records, "A") 
        or verify_dns_records(domain, ip_v6_records, "AAAA"):
            error_detected = True
    return error_detected

if __name__== "__main__":
    if check():
        # ì—ëŸ¬ê°€ ê²€ì¶œë˜ë©´ True ì´ë¯€ë¡œ ë¹„ì •ìƒ í˜¸ìŠ¤íŠ¸ì„ì„ ì˜ë¯¸
        exit(1)
    else:
        # ì •ìƒì¸ ê²½ìš° 0 ê°’ì„ ë¦¬í„´
        exit(0)
```


### URL

**URL ì •ë³´ë¥¼ ì…ë ¥ê°’ìœ¼ë¡œ ë°›ì•„ë“¤ì´ëŠ” ê²½ìš°ëŠ” ì§€ì–‘í•´ì•¼í•©ë‹ˆë‹¤**. ì´ëŠ”, URL ì„ ê²€ì¦í•˜ëŠ” ê³¼ì •ì´ ë§¤ìš° ì–´ë µê³  íŒŒì„œë¥¼ ì•…ìš©í•  ê°€ëŠ¥ì„±ì´ ë†’ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë§Œì•½ ë„¤íŠ¸ì›Œí¬ ì •ë³´ê°€ í•„ìš”í•˜ë‹¤ë©´, ìœ íš¨í•œ IP ì£¼ì†Œ ë˜ëŠ” ë„ë©”ì¸ ì´ë¦„ì„ ê²€ì¦í•˜ë„ë¡ êµ¬í˜„í•©ë‹ˆë‹¤.

### ë„¤íŠ¸ì›Œí¬ ê³„ì¸µ

ë„¤íŠ¸ì›Œí¬ ê³„ì¸µì˜ ë³´ì•ˆì€ ì·¨ì•½í•œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë¬´ë¶„ë³„í•˜ê²Œ ë‹¤ë¥¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ í˜¸ì¶œí•˜ëŠ” ê²ƒì„ ì˜ˆë°©í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤. 

ë”°ë¼ì„œ, í—ˆìš©ëœ ë¼ìš°íŠ¸ë¥¼ í†µí•´ì„œë§Œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤. ì´ë•Œ ë°©í™”ë²½ì„ ì´ìš©í•˜ì—¬ ì ‘ê·¼ì œì–´ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.

<br>
[![SSRF ê³µê²© êµ¬ì„±ë„ 2](https://raw.githubusercontent.com/OWASP/CheatSheetSeries/master/assets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet_Case1_NetworkLayer_PreventFlow.png)](https://raw.githubusercontent.com/OWASP/CheatSheetSeries/master/assets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet_Case1_NetworkLayer_PreventFlow.png)
<br>

<br>
{% include advertisements.html %}
<br>

## ì‚¬ë¡€ 2

**ì‚¬ë¡€1**ì˜ ë‚´ìš©ì´ ê¸¸ë‹¤ë³´ë‹ˆ ì‚¬ë¡€2ì˜ ë‚´ìš©ì„ ìƒê¸°í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì–´ë– í•œ ì™¸ë¶€ IP ë‚˜ ë„ë©”ì¸ìœ¼ë¡œ ìš”ì²­ì„ ì „ì†¡í•˜ëŠ” êµ¬ì„±ì¸ ê²½ìš°ë¥¼ ë‹¤ë£¨ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. 




## ë§ˆë¬´ë¦¬

ë“œë””ì–´ Vue.js ê³µì‹ ë¬¸ì„œ ì •ë³µ(ë½€ê°œê¸°) ê³¼ì •ì—ì„œ Vue ì¸ìŠ¤í„´ìŠ¤ ì˜ì—­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‘ (ì§ì§ì§) ì´ ê³¼ì •ì€ ëª¨ë“  ë¬¸ì„œë¥¼ ì •ë³µí•  ë•Œê¹Œì§€ ë§¤ì¼ ë§¤ì¼ ì—…ë¡œë“œ í•˜ë„ë¡ í• í…Œë‹ˆ ë‚´ì¼ ì´ ì‹œê°„ì—ë„ ì‹œê°„ì„ ë‚´ì–´ [ì½”ë§ˆì˜ í›ˆí›ˆí•œ ë¸”ë¡œê·¸](https://code-machina.github.io) ë¥¼ ì°¾ì•„ì£¼ì„¸ìš”!

<br>
{% include advertisements.html %}
<br>

ë‹¤ìŒ ì‹œê°„ì—ëŠ” `í…œí”Œë¦¿ ë¬¸ë²•`ì„ ì™„ë²½í•˜ê²Œ ì´í•´í•˜ì‹¤ ìˆ˜ ìˆë„ë¡ ì •ë¦¬í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ì•„ì§ ë“œë¦´ ì´ì•¼ê¸°ê°€ ë¬´ê¶ë¬´ì§„í•˜ë‹ˆ ì¢€ ë” ì§€ì¼œë´ì£¼ì‹œë©´ ë”ìš± ê°ì‚¬í•  ê²ƒ ê°™ì•„ìš”! ì—¬ëŸ¬ë¶„ì´ Vue.js ë¥¼ ì¥ë‚œê°ì²˜ëŸ¼ ê°€ì§€ê³  ë…¸ëŠ” ê·¸ë‚ ê¹Œì§€ ì € **ì½”ë§ˆ**ëŠ” ë©ˆì¶”ì§€ ì•Šê² ìŠµë‹ˆë‹¤. ëŒ€í•œë¯¼êµ­ ITì¸ ì—¬ëŸ¬ë¶„ë“¤ì˜ ê±´ìŠ¹ì„ ê¸°ì›í•©ë‹ˆë‹¤.

ì§€ê¸ˆê¹Œì§€ **ì½”ë§ˆ** ì˜€ìŠµë‹ˆë‹¤.

êµ¬ë…í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ë”ìš± ì¢‹ì€ ë‚´ìš©ìœ¼ë¡œ ì°¾ì•„ëµ™ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤

## ë§í¬ ì •ë¦¬

ì´ë²ˆ ì‹œê°„ì— ì°¸ì¡°í•œ ë§í¬ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ì˜ ì •ë¦¬í•˜ì…”ì„œ í•„ìš”í•  ë•Œ ì‚¬ìš©í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.

- [Vue.js 2.x : Guide Docs](https://vuejs.org/v2/guide/index.html)

<br>
{% include advertisements.html %}
<br>
